pipeline:
  agent: any

  environment:
    DOCKER_IMAGE: 'chatlearning123/getting-started/umadocker:latest'
    DOCKER_CREDENTIALS_ID: 'dockerhub-credentials'  # Replace with your actual Docker Hub credentials ID

  stages:
    - stage: Checkout
      steps:
        - echo 'Checking out the repository...'
        - checkout scm
        - echo 'Repository checked out.'

    - stage: Build Docker Image
      steps:
        - script: |
            echo 'Building Docker image...'
            try {
              docker.withRegistry('https://index.docker.io/v1/', env.DOCKER_CREDENTIALS_ID) {
                def customImage = docker.build(env.DOCKER_IMAGE)
                echo 'Docker image built successfully.'
                echo 'Pushing Docker image...'
                customImage.push()
                echo 'Docker image pushed successfully.'
              }
            } catch (Exception e) {
              echo "Failed to build or push Docker image: ${e.toString()}"
              error 'Stopping pipeline due to failure.'
            }

  post:
    success:
      steps:
        - echo 'Pipeline completed successfully.'
    failure:
      steps:
        - echo 'Pipeline failed.'
